{% extends 'admin/admin_base.html' %}

{% block title %}Edit Blog Post{% endblock %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}

<div class="admin-wrapper" >

  <!-- Sidebar -->
  {% include 'partials/admin_nav.html' %}

  <!-- Main Content -->
  <main class="admin-main">
    <!-- Top Row -->
    <div class="admin-topbar">
      <div class="page-title">
        <h2>Edit Blog Post</h2>
      </div>
      <div class="user-info">
        <a class="btn-select" href="{{ url_for('main.admin_blog_post') }}">‚Üê Back to list</a>
        <span class="user-email">admin@atlantalocals</span>
        <span class="user-avatar">üë§</span>
      </div>
    </div>

    <!-- Content Form -->
    <div class="admin-content-container">
      <div class="content-card">
        <!-- We attach the post id on the form for JS -->
        <form method="POST" enctype="multipart/form-data" id="blog-read-update-form" data-post-id="{{ post_id }}">

          <!-- Title -->
          <div class="form-group">
            <label for="title">Post Title</label>
            <input type="text" id="title" name="title" required>
          </div>

          <!-- Slug -->
          <div class="form-group">
            <label for="slug">Slug</label>
            <input type="text" id="slug" name="slug" required>
          </div>

          <!-- Category -->
          <div class="form-group">
            <label for="category">Category</label>
            <select id="category" name="category" required>
              <option value="" selected disabled>Loading categories‚Ä¶</option>
            </select>
          </div>

          <!-- Author -->
          <div class="form-group">
            <label for="author">Author</label>
            <select id="author" name="author" required>
              <option value="" selected disabled>Loading authors‚Ä¶</option>
            </select>
          </div>

          <!-- Image -->
          <div class="form-group">
            <label>Featured Image</label>
            <div style="display:flex; gap:16px; align-items:flex-start;">
              <img id="image-preview" src="" alt="Current image" style="max-width:220px; max-height:140px; object-fit:cover; border:1px solid #eee; border-radius:8px; background:#f8f8f8;">
              <div style="display:flex; flex-direction:column; gap:8px;">
                <input type="file" id="image" name="image" accept="image/*">
                <small id="image-path-note" style="color:#666;">If you choose a new file, it will replace the current image on update.</small>
              </div>
            </div>
          </div>

          <!-- Content (structured sections matching Mongo JSON) -->
          <div class="form-group" id="content-sections">
            <h3>Content</h3>

            <!-- Section 1 -->
            <div class="content-section" data-section="section-1">
              <h4>Section 1</h4>
              <label for="section1-title">Title</label>
              <input type="text" id="section1-title" name="content[section-1][title]" required>

              <label for="section1-paragraph1">Paragraph 1</label>
              <textarea id="section1-paragraph1" name="content[section-1][paragraph-1]" rows="3" required></textarea>

              <label for="section1-paragraph2">Paragraph 2</label>
              <textarea id="section1-paragraph2" name="content[section-1][paragraph-2]" rows="3"></textarea>

              <label for="section1-paragraph3">Paragraph 3</label>
              <textarea id="section1-paragraph3" name="content[section-1][paragraph-3]" rows="3"></textarea>
            </div>

            <!-- Section 2 -->
            <div class="content-section" data-section="section-2">
              <h4>Section 2</h4>
              <label for="section2-title">Title</label>
              <input type="text" id="section2-title" name="content[section-2][title]" required>

              <label for="section2-paragraph1">Paragraph 1</label>
              <textarea id="section2-paragraph1" name="content[section-2][paragraph-1]" rows="3" required></textarea>

              <label for="section2-paragraph2">Paragraph 2</label>
              <textarea id="section2-paragraph2" name="content[section-2][paragraph-2]" rows="3"></textarea>

              <label for="section2-paragraph3">Paragraph 3</label>
              <textarea id="section2-paragraph3" name="content[section-2][paragraph-3]" rows="3"></textarea>
            </div>

            <!-- Section 3 -->
            <div class="content-section" data-section="section-3">
              <h4>Section 3</h4>
              <label for="section3-title">Title</label>
              <input type="text" id="section3-title" name="content[section-3][title]" required>

              <label for="section3-paragraph1">Paragraph 1</label>
              <textarea id="section3-paragraph1" name="content[section-3][paragraph-1]" rows="3" required></textarea>

              <label for="section3-paragraph2">Paragraph 2</label>
              <textarea id="section3-paragraph2" name="content[section-3][paragraph-2]" rows="3"></textarea>

              <label for="section3-paragraph3">Paragraph 3</label>
              <textarea id="section3-paragraph3" name="content[section-3][paragraph-3]" rows="3"></textarea>
            </div>

            <!-- Section 4 -->
            <div class="content-section" data-section="section-4">
              <h4>Section 4</h4>
              <label for="section4-title">Title</label>
              <input type="text" id="section4-title" name="content[section-4][title]" required>

              <label for="section4-paragraph1">Paragraph 1</label>
              <textarea id="section4-paragraph1" name="content[section-4][paragraph-1]" rows="3" required></textarea>

              <label for="section4-paragraph2">Paragraph 2</label>
              <textarea id="section4-paragraph2" name="content[section-4][paragraph-2]" rows="3"></textarea>

              <label for="section4-paragraph3">Paragraph 3</label>
              <textarea id="section4-paragraph3" name="content[section-4][paragraph-3]" rows="3"></textarea>
            </div>

            <!-- Section 5 -->
            <div class="content-section" data-section="section-5">
              <h4>Section 5</h4>
              <label for="section5-title">Title</label>
              <input type="text" id="section5-title" name="content[section-5][title]" required>

              <label for="section5-paragraph1">Paragraph 1</label>
              <textarea id="section5-paragraph1" name="content[section-5][paragraph-1]" rows="3" required></textarea>

              <label for="section5-paragraph2">Paragraph 2</label>
              <textarea id="section5-paragraph2" name="content[section-5][paragraph-2]" rows="3"></textarea>

              <label for="section5-paragraph3">Paragraph 3</label>
              <textarea id="section5-paragraph3" name="content[section-5][paragraph-3]" rows="3"></textarea>
            </div>

            <!-- Section 6 (Conclusion) -->
            <div class="content-section" data-section="section-6-conclusion">
              <h4>Section 6 ‚Äî Conclusion</h4>
              <label for="section6-title">Title</label>
              <input type="text" id="section6-title" name="content[section-6-conclusion][title]" required>

              <label for="section6-paragraph1">Paragraph 1</label>
              <textarea id="section6-paragraph1" name="content[section-6-conclusion][paragraph-1]" rows="3" required></textarea>

              <label for="section6-paragraph2">Paragraph 2</label>
              <textarea id="section6-paragraph2" name="content[section-6-conclusion][paragraph-2]" rows="3"></textarea>

              <label for="section6-paragraph3">Paragraph 3</label>
              <textarea id="section6-paragraph3" name="content[section-6-conclusion][paragraph-3]" rows="3"></textarea>
            </div>

            <!-- Section 7 (Associated Press / attribution) -->
            <div class="content-section" data-section="section-7-assoc-press">
              <h4>Section 7 ‚Äî Associated Press</h4>
              <label for="section7-title">Title</label>
              <input type="text" id="section7-title" name="content[section-7-assoc-press][title]">

              <label for="section7-paragraph1">Paragraph 1</label>
              <textarea id="section7-paragraph1" name="content[section-7-assoc-press][paragraph-1]" rows="3"></textarea>
            </div>

            <!-- Section 8 ‚Äî FAQs -->
            <div class="content-section" data-section="section-8-faqs">
              <h4>Section 8 ‚Äî FAQs</h4>
              <div id="faqs">
                <!-- Five default FAQ rows -->
                <div class="faq-item">
                  <label>Question</label>
                  <input type="text" name="content[section-8-faqs][0][question]">
                  <label>Answer</label>
                  <textarea name="content[section-8-faqs][0][answer]" rows="3"></textarea>
                </div>

                <div class="faq-item">
                  <label>Question</label>
                  <input type="text" name="content[section-8-faqs][1][question]">
                  <label>Answer</label>
                  <textarea name="content[section-8-faqs][1][answer]" rows="3"></textarea>
                </div>

                <div class="faq-item">
                  <label>Question</label>
                  <input type="text" name="content[section-8-faqs][2][question]">
                  <label>Answer</label>
                  <textarea name="content[section-8-faqs][2][answer]" rows="3"></textarea>
                </div>

                <div class="faq-item">
                  <label>Question</label>
                  <input type="text" name="content[section-8-faqs][3][question]">
                  <label>Answer</label>
                  <textarea name="content[section-8-faqs][3][answer]" rows="3"></textarea>
                </div>

                <div class="faq-item">
                  <label>Question</label>
                  <input type="text" name="content[section-8-faqs][4][question]">
                  <label>Answer</label>
                  <textarea name="content[section-8-faqs][4][answer]" rows="3"></textarea>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions -->
          <div class="form-group" style="display:flex; gap:12px; flex-wrap:wrap;">
            <button type="submit" class="btn-select" id="btn-update">Update</button>
            <button type="button" class="btn-select" id="btn-cancel">Cancel</button>
            <a class="btn-select" href="{{ url_for('main.admin_blog_post') }}">Back to list</a>
          </div>

          <div class="form-group" style="margin-top:8px;">
            <button type="button" class="btn-danger" id="btn-delete" style="background:#d9534f; color:#fff;">Delete</button>
          </div>

        </form>
      </div>
    </div>
  </main>
</div>

{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/blog_read_update.js') }}"></script>
{% endblock %}
